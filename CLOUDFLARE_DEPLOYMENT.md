# ğŸŒ Cloudflare Pages éƒ¨ç½²æŒ‡å—

ä¸“ä¸ºCloudflare Pagesä¼˜åŒ–çš„é™æ€éƒ¨ç½²ç‰ˆæœ¬ï¼Œè¾“å‡ºåˆ°`out/`ç›®å½•ã€‚

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æ–¹æ³•1: Git è¿æ¥éƒ¨ç½² (æ¨è)

1. **æ¨é€ä»£ç åˆ°Gitä»“åº“**
   ```bash
   git add .
   git commit -m "Add Cloudflare Pages static build"
   git push origin main
   ```

2. **åœ¨Cloudflare Dashboardä¸­è®¾ç½®**
   - ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com)
   - é€‰æ‹© "Pages" â†’ "Create a project"
   - è¿æ¥ä½ çš„Gitä»“åº“
   - é…ç½®æ„å»ºè®¾ç½®ï¼š
     - **æ„å»ºå‘½ä»¤**: `npm run build:cloudflare`
     - **è¾“å‡ºç›®å½•**: `out`
     - **Node.jsç‰ˆæœ¬**: `18` (æˆ–æ›´é«˜)

3. **è®¾ç½®ç¯å¢ƒå˜é‡** (å¯é€‰)
   ```
   DOMAIN=ä½ çš„åŸŸå.com
   ```

4. **éƒ¨ç½²å®Œæˆ**
   - Cloudflareä¼šè‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²
   - æ¯æ¬¡æ¨é€éƒ½ä¼šè§¦å‘é‡æ–°éƒ¨ç½²

### æ–¹æ³•2: æ‰‹åŠ¨ä¸Šä¼ 

1. **æœ¬åœ°æ„å»º**
   ```bash
   # å®‰è£…ä¾èµ–
   npm install

   # æ„å»ºé™æ€æ–‡ä»¶
   npm run build:static
   ```

2. **ä¸Šä¼ åˆ°Cloudflare Pages**
   - è®¿é—® Cloudflare Dashboard
   - é€‰æ‹© "Pages" â†’ "Upload assets"
   - ä¸Šä¼ æ•´ä¸ª `out/` ç›®å½•

## ğŸ“ é™æ€æ„å»ºè¾“å‡ºç»“æ„

```
out/
â”œâ”€â”€ index.html              # ä¸»é¡µé¢
â”œâ”€â”€ flamy-dash.png          # æ¸¸æˆå°é¢å›¾
â”œâ”€â”€ css/
â”‚   â””â”€â”€ game-integration.css
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ api-client.js       # é™æ€APIå®¢æˆ·ç«¯
â”‚   â””â”€â”€ game-loader.js      # æ¸¸æˆåŠ è½½å™¨
â”œâ”€â”€ games/
â”‚   â””â”€â”€ flamy-dash/
â”‚       â””â”€â”€ latest/
â”‚           â””â”€â”€ index.html  # æ¸¸æˆåµŒå…¥é¡µé¢
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ games.json          # æ¸¸æˆé…ç½®
â”‚   â”œâ”€â”€ azgame-response.json # AzGameå…¼å®¹å“åº”
â”‚   â””â”€â”€ health.json         # å¥åº·æ£€æŸ¥
â”œâ”€â”€ _headers                # Cloudflareå¤´éƒ¨é…ç½®
â””â”€â”€ _redirects              # é‡å®šå‘è§„åˆ™
```

## âš™ï¸ æ„å»ºé…ç½®

### ç¯å¢ƒå˜é‡

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `DOMAIN` | `flamydash.com` | ä½ çš„åŸŸå |

### æ„å»ºå‘½ä»¤

```bash
# ä½¿ç”¨é»˜è®¤åŸŸåæ„å»º
npm run build

# ä½¿ç”¨æŒ‡å®šåŸŸåæ„å»º
DOMAIN=your-domain.com npm run build:cloudflare

# æˆ–è€…
npm run build:cloudflare
```

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹åŸŸå

1. **æ„å»ºæ—¶æŒ‡å®š**:
   ```bash
   DOMAIN=your-domain.com npm run build:cloudflare
   ```

2. **ä¿®æ”¹æ„å»ºè„šæœ¬**:
   ç¼–è¾‘ `build-static.js` ä¸­çš„é»˜è®¤åŸŸåï¼š
   ```javascript
   this.domain = 'your-domain.com';
   ```

### ä¿®æ”¹æ¸¸æˆé…ç½®

ç¼–è¾‘ `server/config/games.json`ï¼š

```json
{
  "games": {
    "flamy-dash": {
      "name": "Your Game Name",
      "description": "Your game description",
      "iframe_url": "https://your-domain.com/games/your-game/latest/",
      "width": 960,
      "height": 600
    }
  }
}
```

### æ·»åŠ æ–°æ¸¸æˆ

1. åœ¨ `games/` ç›®å½•ä¸‹åˆ›å»ºæ¸¸æˆæ–‡ä»¶å¤¹
2. æ›´æ–° `server/config/games.json`
3. é‡æ–°æ„å»º: `npm run build`

## ğŸŒ åŸŸåè®¾ç½®

### ä½¿ç”¨è‡ªå®šä¹‰åŸŸå

1. **åœ¨Cloudflare Pagesä¸­è®¾ç½®**:
   - è¿›å…¥ä½ çš„Pagesé¡¹ç›®
   - é€‰æ‹© "Custom domains"
   - æ·»åŠ ä½ çš„åŸŸå

2. **DNSé…ç½®**:
   - æ·»åŠ CNAMEè®°å½•æŒ‡å‘Cloudflare Pages
   - æˆ–ä½¿ç”¨Cloudflareä½œä¸ºDNSæä¾›å•†

3. **SSLè®¾ç½®**:
   - Cloudflareä¼šè‡ªåŠ¨æä¾›SSLè¯ä¹¦
   - ç¡®ä¿SSLæ¨¡å¼è®¾ç½®ä¸º"Full"æˆ–"Full (strict)"

## ğŸ” é™æ€æ¨¡å¼ç‰¹æ€§

### ä¸å®Œæ•´ç‰ˆæœ¬çš„åŒºåˆ«

| åŠŸèƒ½ | å®Œæ•´ç‰ˆ | é™æ€ç‰ˆ |
|------|--------|--------|
| åŠ¨æ€API | âœ… | âŒ |
| é™æ€é…ç½® | âŒ | âœ… |
| æœåŠ¡å™¨ä¾èµ– | âœ… | âŒ |
| æ¸¸æˆåµŒå…¥ | âœ… | âœ… |
| äº‹ä»¶è¿½è¸ª | æ•°æ®åº“ | localStorage + GA |
| åŠ è½½æ€§èƒ½ | ä¸­ç­‰ | ä¼˜ç§€ |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ |

### é™æ€ç‰ˆæœ¬åŠŸèƒ½

âœ… **ä¿ç•™çš„åŠŸèƒ½**:
- å®Œæ•´çš„æ¸¸æˆiframeé›†æˆ
- åŠ è½½çŠ¶æ€ç®¡ç†å’Œè¿›åº¦æ˜¾ç¤º
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- å“åº”å¼è®¾è®¡å’Œç§»åŠ¨ç«¯æ”¯æŒ
- å…¨å±åŠŸèƒ½å’Œæ¸¸æˆæ§åˆ¶
- åŒå‘iframeé€šä¿¡
- Google Analyticsé›†æˆ

âœ… **é™æ€åŒ–æ”¹è¿›**:
- é¢„ç”Ÿæˆçš„é…ç½®æ–‡ä»¶
- æœ¬åœ°äº‹ä»¶å­˜å‚¨
- CDNä¼˜åŒ–çš„èµ„æºåŠ è½½
- æ›´å¿«çš„é¡µé¢åŠ è½½é€Ÿåº¦
- é›¶æœåŠ¡å™¨ç»´æŠ¤æˆæœ¬

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### Cloudflareä¼˜åŒ–è®¾ç½®

1. **ç¼“å­˜é…ç½®** (é€šè¿‡`_headers`æ–‡ä»¶):
   ```
   /js/* - 1å¤©ç¼“å­˜
   /css/* - 1å¤©ç¼“å­˜
   /images/* - 1å‘¨ç¼“å­˜
   /config/* - 5åˆ†é’Ÿç¼“å­˜
   ```

2. **å‹ç¼©è®¾ç½®**:
   - è‡ªåŠ¨å¯ç”¨Brotliå‹ç¼©
   - è‡ªåŠ¨å›¾ç‰‡ä¼˜åŒ–

3. **CDNè®¾ç½®**:
   - å…¨çƒCDNåˆ†å‘
   - è‡ªåŠ¨HTTP/2æ¨é€

### å‰ç«¯ä¼˜åŒ–

- **æ‡’åŠ è½½**: æ¸¸æˆiframeæŒ‰éœ€åŠ è½½
- **èµ„æºé¢„åŠ è½½**: å…³é”®CSSå’ŒJSä¼˜å…ˆåŠ è½½
- **å›¾ç‰‡ä¼˜åŒ–**: ä½¿ç”¨WebPæ ¼å¼ (å¦‚æœæ”¯æŒ)

## ğŸ”’ å®‰å…¨é…ç½®

### HTTPå¤´éƒ¨è®¾ç½®

é€šè¿‡`_headers`æ–‡ä»¶é…ç½®çš„å®‰å…¨å¤´éƒ¨:

```
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
```

### iframeå®‰å…¨

- æ¸¸æˆiframeä½¿ç”¨æ²™ç®±æƒé™
- é™åˆ¶iframeåªèƒ½ä»ç›¸åŒåŸŸååŠ è½½

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### æ„å»ºæµ‹è¯•

```bash
# æ„å»ºé™æ€æ–‡ä»¶
npm run build

# æ£€æŸ¥è¾“å‡ºæ–‡ä»¶
ls -la out/

# æœ¬åœ°é¢„è§ˆ (éœ€è¦HTTPæœåŠ¡å™¨)
npx serve out
```

### éƒ¨ç½²åæµ‹è¯•

1. **åŸºç¡€åŠŸèƒ½æµ‹è¯•**:
   - è®¿é—®ä¸»é¡µé¢
   - ç‚¹å‡»æ¸¸æˆåŠ è½½æŒ‰é’®
   - éªŒè¯iframeæ­£å¸¸æ˜¾ç¤º
   - æµ‹è¯•å…¨å±åŠŸèƒ½

2. **æ€§èƒ½æµ‹è¯•**:
   ```bash
   # ä½¿ç”¨lighthouse
   lighthouse https://your-domain.com --output html

   # æ£€æŸ¥é¡µé¢åŠ è½½é€Ÿåº¦
   curl -w "@curl-format.txt" -o /dev/null -s https://your-domain.com
   ```

3. **ç§»åŠ¨ç«¯æµ‹è¯•**:
   - ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·
   - æµ‹è¯•ä¸åŒå±å¹•å°ºå¯¸
   - éªŒè¯è§¦æ‘¸æ“ä½œ

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ„å»ºå¤±è´¥**:
   ```bash
   # æ£€æŸ¥Node.jsç‰ˆæœ¬
   node --version

   # æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
   rm -rf node_modules package-lock.json
   npm install
   ```

2. **æ¸¸æˆæ— æ³•åŠ è½½**:
   - æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
   - éªŒè¯iframe URLæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤åŸŸåé…ç½®æ­£ç¡®

3. **æ ·å¼æ˜¾ç¤ºå¼‚å¸¸**:
   - æ£€æŸ¥CSSæ–‡ä»¶è·¯å¾„
   - éªŒè¯æ„å»ºè¾“å‡ºæ˜¯å¦å®Œæ•´
   - æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹æ„å»ºæ—¥å¿—**:
   - Cloudflare Pagesæ§åˆ¶å°ä¸­çš„æ„å»ºæ—¥å¿—
   - æ£€æŸ¥æ„å»ºå‘½ä»¤è¾“å‡º

2. **æœ¬åœ°è°ƒè¯•**:
   ```bash
   # æ„å»ºå¹¶æœ¬åœ°è¿è¡Œ
   npm run build
   npx serve out
   ```

3. **è¿œç¨‹è°ƒè¯•**:
   - ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·
   - æ£€æŸ¥ç½‘ç»œè¯·æ±‚çŠ¶æ€
   - æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

## ğŸ“ˆ è¿›ä¸€æ­¥ä¼˜åŒ–

### é«˜çº§åŠŸèƒ½

1. **PWAæ”¯æŒ**:
   - æ·»åŠ Service Worker
   - é…ç½®åº”ç”¨æ¸…å•
   - æ”¯æŒç¦»çº¿è®¿é—®

2. **A/Bæµ‹è¯•**:
   - ä½¿ç”¨Cloudflare Workers
   - å¤šç‰ˆæœ¬æ¸¸æˆé…ç½®

3. **å®æ—¶åˆ†æ**:
   - é›†æˆGoogle Analytics 4
   - è‡ªå®šä¹‰äº‹ä»¶è¿½è¸ª
   - ç”¨æˆ·è¡Œä¸ºåˆ†æ

### æ‰©å±•å»ºè®®

1. **å¤šæ¸¸æˆæ”¯æŒ**:
   - æ¸¸æˆé€‰æ‹©ç•Œé¢
   - åŠ¨æ€æ¸¸æˆåŠ è½½
   - æ¸¸æˆåˆ†ç±»ç³»ç»Ÿ

2. **ç”¨æˆ·åŠŸèƒ½**:
   - åˆ†æ•°ä¿å­˜
   - æˆå°±ç³»ç»Ÿ
   - ç¤¾äº¤åˆ†äº«

---

ğŸ® **äº«å—åœ¨Cloudflare Pagesä¸Šçš„æé€Ÿæ¸¸æˆä½“éªŒï¼**